{% extends 'base.html' %}
{% load pybo_filter %}
{% block content %}

<div class="container my-3">
    <div class="row my-3">
        <div class="col text-center">
            <h2>직원 PC보안 매뉴얼 점검표(매주)</h2>
        </div>
        
    </div>
    <div class="row my-3">        
        <div class="col-12">
            개인정보보호 및 효율적인 보안업무 수행을 위해 정보통신시설에 포함된 기기는 아래의 매뉴얼에 따라 각 PC의 보안관리를 수행하여 주시고 점검하기 바랍니다.
        </div>
    </div>
    <form method="post">
        {% csrf_token %}
     <table class="table " style="border-top: 2px solid #222324;border-bottom: 2px solid #222324;" > 
        <tr>
            <th class="text-center " style="width: 10%; border: 1px dotted #222324;">일자 :</th>
            <td class="text-start" style="width: 30%;border: 1px dotted #222324;"><input type="text" name="p_m_c_wdate" id="p_m_c_wdate" class="w-100" value="{{p_m_c_wdate}}" placeholder="0000-00-00"></td>
            <th class="text-center " style="width: 10%;border: 1px dotted #222324;" rowspan="2">결제 </th>
            <td class="text-center " style="width: 25%;border: 1px dotted #222324;">담당</td>       
            <td class="text-center" style="width: 25%;border: 1px dotted #222324;">원장</td>
        </tr>
        <tr >
            <th class="text-center" style="border: 1px dotted #222324;" >작성자 :</th>
            <td class="text-start" style="border: 1px dotted #222324;"><input type="text" name="writer" id="writer" class="w-100" value="{{p_username}}" readonly></td>
            {% if p_wb_check == 'Y' %}
            <td class="text-center" style="border: 1px dotted #222324;"> <a href="#" class="btn btn-success" id="ch_check">승인취소</a> </td>
            {% else %}
            <td class="text-center" style="border: 1px dotted #222324;"> <a href="#" class="btn btn-primary" id="ch_check">승인</a> </td>
            {% endif %}
            {% if p_wb_review_check == 'Y' %}
            <td class="text-center" style="border: 1px dotted #222324;"> <a href="#" class="btn btn-success" id="review_check">승인취소</a> </td>
            {% else %}
            <td class="text-center" style="border: 1px dotted #222324;"> <a href="#" class="btn btn-primary" id="review_check">승인</a> </td>
            {% endif %}
            
        </tr>
        
        
     </table>
    <table class="table table-striped"> 
        
        <thead class="table-dark">
        <tr>
            <th class="text-start " style="width: 70%;" colspan="3">PC관리</th>            
                        
        </tr>
        </thead>
        
        <tbody>           
        {%if ps_list_p %}
        
        {% for c_quest in ps_list_p %}        
        <tr>
            <td class="text-center">
                <!-- 번호 = 전체건수 - 시작인덱스 - 현재인덱스 + 1 -->
                {{ forloop.counter }}                
            </td>
            <!-- <td>{{ forloop.counter }}</td> -->
            <td class="text-start">
                {{ c_quest.p_m_title }}               
            </td>              
            <td class="text-center">
               {{c_quest.p_m_c_val}}               
            </td>
                    
        </tr>
        
        {% endfor %}    
        
        {% else %}
        <tr>
            <td colspan="3">질문이 없습니다.</td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    <table class="table table-striped"> 
        
        <thead class="table-dark">
        <tr>
            <th class="text-start " style="width: 70%;" colspan="3">USB 관리</th>            
                       
        </tr>
        </thead>
        
        <tbody>           
        {%if ps_list_u %}
        
        {% for u_quest in ps_list_u %}        
        <tr>
            <td class="text-center">
                <!-- 번호 = 전체건수 - 시작인덱스 - 현재인덱스 + 1 -->
                {{ forloop.counter }}                
            </td>
            <!-- <td>{{ forloop.counter }}</td> -->
            <td class="text-start">
                {{ u_quest.p_m_title }}
               
            </td>  
            <td class="text-center">
               {{u_quest.p_m_c_val}}               
            </td>
                    
        </tr>
        
        {% endfor %}    
        
        {% else %}
        <tr>
            <td colspan="2">질문이 없습니다.</td>
        </tr>
        {% endif %}
        </tbody>
    </table>

    <table class="table table-striped"> 
        
        <thead class="table-dark">
        <tr>
            <th class="text-start " style="width: 70%;" colspan="3">개인정보 관리</th>            
                      
        </tr>
        </thead>
        
        <tbody>           
        {%if ps_list_pe %}
        
        {% for pe_quest in ps_list_pe    %}        
        <tr>
            <td class="text-center">
                <!-- 번호 = 전체건수 - 시작인덱스 - 현재인덱스 + 1 -->
                {{ forloop.counter }}                
            </td>
            <!-- <td>{{ forloop.counter }}</td> -->
            <td class="text-start">
                {{ pe_quest.p_m_title }}
               
            </td>  
            <td class="text-center">
               {{pe_quest.p_m_c_val}}               
            </td>
                    
        </tr>
        
        {% endfor %}    
        
        {% else %}
        <tr>
            <td colspan="2">질문이 없습니다.</td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    {% if p_wb_check != 'Y' and p_username == user.username %}
   <a href="{% url 'psecu:psecu_modify' p_wb_idx %}" class="btn btn-primary">수정하기</a>
    {% endif %}


    <input type="hidden" name="p_wb_idx" id = "p_wb_idx" value="{{p_wb_idx}}">
    <input type="hidden" name="p_m_b"  id = "p_m_b" value="1">
   </form>
</div>

{% endblock %}
{% block script %}
<script type='text/javascript'>
    document.getElementById("ch_check").addEventListener("click", function() {        
        p_wb_idx = document.getElementById("p_wb_idx").value;
        p_m_b = document.getElementById("p_m_b").value;

        $.ajax({
        type:'POST',
        url:"{% url 'psecu:psecu_ch_confirm' %}",
        data:{
            'p_m_b': p_m_b,
            'p_wb_idx': p_wb_idx         
            },
        headers: {"X-CSRFToken": "{{ csrf_token }}"},
        success:function(json){            
            p_check = json.p_check;           
            if (p_check == 'Y'){
                 alert("담당자의 승인이 완료되었습니다.");
                $("#ch_check").removeClass("btn-primary").addClass("btn-success");
                $("#ch_check").text("승인취소");
            }else if (p_check == 'N') {
                alert("담당자의 승인이 취소되었습니다.");
                $("#ch_check").removeClass("btn-success").addClass("btn-primary");
                $("#ch_check").text("승인");
            }else {
                alert("담당이 권한이  있습니다. 확인해 보세요.");
            }

        },
        error : function(xhr,errmsg,err) {
        console.log(xhr.status + ": " + xhr.responseText); 
        }
   });
    });
    document.getElementById("review_check").addEventListener("click", function() {
       
        p_wb_idx = document.getElementById("p_wb_idx").value;
        p_m_b = document.getElementById("p_m_b").value;

        $.ajax({
        type:'POST',
        url:"{% url 'psecu:psecu_review_confirm' %}",
        data:{
            'p_m_b': p_m_b,
            'p_wb_idx': p_wb_idx         
            },
        headers: {"X-CSRFToken": "{{ csrf_token }}"},
        success:function(json){            
            p_check = json.p_check;           
            if (p_check == 'Y'){
                 alert("원장이 승인이 완료되었습니다.");
                $("#review_check").removeClass("btn-primary").addClass("btn-success");
                $("#review_check").text("승인취소");
            }else if (p_check == 'N') {
                alert("원장의 승인이 취소되었습니다.");
                $("#review_check").removeClass("btn-success").addClass("btn-primary");
                $("#review_check").text("승인");
            }else {
                alert("원장이 승인을 하셔야 합니다. 확인해 보세요.");
            }

        },
        error : function(xhr,errmsg,err) {
        console.log(xhr.status + ": " + xhr.responseText); 
        }
     });
    }); 
</script>
<!-- <script type='text/javascript'>
const page_elements = document.getElementsByClassName("page-link");
Array.from(page_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        document.getElementById('page').value = this.dataset.page;
        document.getElementById('searchForm').submit();
    });
});
const btn_search = document.getElementById("btn_search");
btn_search.addEventListener('click', function() {
    document.getElementById('kw').value = document.getElementById('search_kw').value;
    document.getElementById('page').value = 1;  // 검색버튼을 클릭할 경우 1페이지부터 조회한다.
    document.getElementById('searchForm').submit();
});
</script> -->


{% endblock %}