{% extends 'base.html' %}
{% load static %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
<link      rel="stylesheet"      href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"    />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<div class="container">
    <h5 class="my-3 border-bottom pb-2">휴가계</h5>
    <form method="post" action="{% url 'vaca:leave_request' %}">
        {% csrf_token %}
      <!-- 오류표시 Start -->
        {% if form.errors %}
        <div class="alert alert-danger" role="alert">
            {% for field in form %}
            {% if field.errors %}
            <div>
                <strong>{{ field.label }}</strong>
                {{ field.errors }}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        <!-- 오류표시 End -->
        <div class="mb-3">
            <label for="dr_date" class="form-label">휴가종류</label>
            <select  class="form-control" name="leave_type" id="leave_type">
                {% for leave_type in leave_types %}
                <option value='{{ leave_type.leave_type_id }}' {% if leave_type.leave_type_id == form.leave_type.value %}selected{% endif %}>{{ leave_type.type_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3" >
            <label for="start_date" class="form-label">휴가날짜</label>
            <div style="display: inline-flex;">
                    <input type="text" class="form-control" name="start_date" id="start_date"   value="{{ form.start_date.value|date:'Y-m-d'|default_if_none:'' }}" style="width: 100%;" > ~
                    <input type="text" class="form-control" name="end_date" id="end_date"  value="{{ form.end_date.value|date:'Y-m-d'|default_if_none:'' }}" style="width: 100%;" >
            </div>
        </div>
        
        <div class="mb-3">
            <label for="reason" class="form-label">사유</label>
            <textarea class="form-control" name="reason"
                      id="reason" rows="10">{{ form.reason.value|default_if_none:'' }}</textarea>
        </div>
        
       
       
       
        <button type="submit" class="btn btn-primary">신청하기</button>
    </form>
</div>

{% endblock %}
{% block script %}

<script>
    
      $('#reason').summernote({
        placeholder: '휴가 신청 사유를 입력하세요.',
        tabsize: 2,
        height: 400,
        toolbar: [
          ['style', ['style']],
          ['font', ['bold', 'underline', 'clear']],
          ['color', ['color']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['table', ['table']],
          ['insert', ['link', 'picture', 'video']],
          ['view', ['fullscreen', 'codeview', 'help']]
        ],
        callbacks: {
            onImageUpload: function(image) {
                console.log('in');
                const file = image[0];
                const reader = new FileReader();
                reader.onloadend = function() {
                    const image = $('<img>').attr('src',  reader.result);
                    image.attr('width','100%');
                    $('#dr_content').summernote("insertNode", image[0]);
                }
                reader.readAsDataURL(file);
            }
        }
        
        
      });
       
    const markupStr = "{{form.reason.value|safe|addslashes|default_if_none:''}}"
    $('#reason').summernote('code', markupStr);
    
    function onImageUpload (image) {
    console.log('in');
    const file = image[0];
    const reader = new FileReader();
    reader.onloadend = function() {
        const image = $('<img>').attr('src',  reader.result);
        image.attr('width','100%');
        $('#reason').summernote("insertNode", image[0]);
    }
    reader.readAsDataURL(file);
    }
    </script>

    <script>
      $(function () {
        $("#start_date, #end_date").datepicker({ dateFormat: "yy-mm-dd" });
      });
    </script>
{% endblock %}