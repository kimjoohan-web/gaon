{% extends 'base.html' %}
{% load static %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
<link      rel="stylesheet"      href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"    />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<div class="container">
    <h5 class="my-3 border-bottom pb-2">기안서</h5>
    <form method="post"  enctype="multipart/form-data">
        {% csrf_token %}
      <!-- 오류표시 Start -->
        {% if form.errors %}
        <div class="alert alert-danger" role="alert">
            {% for field in form %}
            {% if field.errors %}
            <div>
                <strong>{{ field.label }}</strong>
                {{ field.errors }}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        <!-- 오류표시 End -->
         <div class="mb-3">
            <label for="dr_title" class="form-label">문서번호</label>
            <input type="text" class="form-control" name="dr_no" id="dr_no"
                   value="{{ form.dr_no.value|default_if_none:'' }}">
        </div>
        <div class="mb-3">
            <label for="dr_date" class="form-label">기안날짜</label>
            <input type="text" class="form-control" name="dr_date" id="dr_date"
                   value="{{ form.dr_date.value|date:'Y-m-d'|default_if_none:'' }}">
        </div>
        <div class="mb-3">
            <label for="dr_title" class="form-label">기안제목</label>
            <input type="text" class="form-control" name="dr_title" id="dr_title"
                   value="{{ form.dr_title.value|default_if_none:'' }}">
        </div>
        <div class="mb-3">
            <label for="dr_content" class="form-label">내용</label>
            <textarea class="form-control" name="dr_content"
                      id="dr_content" rows="10">{{ form.dr_content.value|default_if_none:'' }}</textarea>
        </div>
        
       
        <div class="mb-3">
            <label for="dr_attachfile" class="form-label">첨부파일</label>
           {% if gdraft.dr_attachfile %}
            기존 파일 <a href="/gdraft/download?path={{ gdraft.dr_attachfile}}">{{gdraft.dr_attachfile}}</a> 
           {% endif %}
            <input type="file" class="form-control" name="dr_attachfile" id="dr_attachfile">
        </div>
        <div class="mb-3">
            <label for="dr_save_status" class="form-label">저장상태</label>
            <select  class="form-control" name="dr_save_status" id="dr_save_status">
                 <option value='임시저장' {% if '임시저장' == gdraft.dr_save_status %}selected{% endif %}>임시저장</option>
                <option value='작성완료' {% if '작성완료' == gdraft.dr_save_status %}selected{% endif %}>작성완료</option>
            </select>
            
        </div>
        <button type="submit" class="btn btn-primary">저장하기</button>
    </form>
</div>

{% endblock %}
{% block script %}

<script>
    
      $('#dr_content').summernote({
        placeholder: '1. 귀 부서의 건승을 기원합니다.<br><br>                2. 사내 업무 효율 향상을 위해 노트북 구매를 아래와 같이 기안합니다.<br><br>                - 아 래 -<br>                가. 품목: 노트북 (모델명: ABC-123) 2대<br>                나. 목적: 신규 입사자 배정 및 노후 기기 교체<br>                다. 금액: 3,000,000원 (VAT 포함)<br>                라. 납기: 202X.01.30까지<br><br>                붙임: 비교견적서 1부. 끝.',        
        tabsize: 2,
        height: 400,
        toolbar: [
          ['style', ['style']],
          ['font', ['bold', 'underline', 'clear']],
          ['color', ['color']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['table', ['table']],
          ['insert', ['link', 'picture', 'video']],
          ['view', ['fullscreen', 'codeview', 'help']]
        ],
        callbacks: {
            onImageUpload: function(image) {
                console.log('in');
                const file = image[0];
                const reader = new FileReader();
                reader.onloadend = function() {
                    const image = $('<img>').attr('src',  reader.result);
                    image.attr('width','100%');
                    $('#dr_content').summernote("insertNode", image[0]);
                }
                reader.readAsDataURL(file);
            }
        }
        
        
      });
       
    const markupStr = "{{form.dr_content.value|safe|addslashes|default_if_none:''}}"
    $('#dr_content').summernote('code', markupStr);
    
    function onImageUpload (image) {
    console.log('in');
    const file = image[0];
    const reader = new FileReader();
    reader.onloadend = function() {
        const image = $('<img>').attr('src',  reader.result);
        image.attr('width','100%');
        $('#dr_content').summernote("insertNode", image[0]);
    }
    reader.readAsDataURL(file);
    }
    </script>

    <script>
      $(function () {
        $("#dr_date").datepicker({ dateFormat: "yy-mm-dd" });
      });
    </script>
{% endblock %}